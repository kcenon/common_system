$schema: "http://json-schema.org/draft-07/schema#"
title: "Unified System Configuration"
description: "Configuration schema for the unified_system components"
type: object

properties:
  unified_system:
    type: object
    description: "Root configuration namespace"
    properties:

      thread:
        type: object
        description: "Thread pool configuration"
        properties:
          pool_size:
            type: integer
            minimum: 0
            maximum: 256
            default: 0
            description: "Number of worker threads (0 for auto-detect based on hardware)"
          queue_type:
            type: string
            enum: [mutex, lockfree, bounded]
            default: lockfree
            description: "Task queue implementation type"
          max_queue_size:
            type: integer
            minimum: 100
            maximum: 10000000
            default: 10000
            description: "Maximum pending tasks in queue"
          thread_name_prefix:
            type: string
            default: "worker"
            description: "Prefix for worker thread names"

      logger:
        type: object
        description: "Logging system configuration"
        properties:
          level:
            type: string
            enum: [trace, debug, info, warn, error, critical, off]
            default: info
            description: "Minimum log level to output"
          writers:
            type: array
            items:
              type: string
              enum: [console, file, rotating_file, network, json]
            default: [console]
            description: "List of log output destinations"
          async:
            type: boolean
            default: true
            description: "Enable asynchronous logging for better performance"
          buffer_size:
            type: integer
            minimum: 1024
            maximum: 1048576
            default: 8192
            description: "Async buffer size in bytes"
          file_path:
            type: string
            default: "./logs/app.log"
            description: "Log file path for file writers"
          max_file_size:
            type: integer
            minimum: 1048576
            maximum: 1073741824
            default: 10485760
            description: "Maximum log file size in bytes (for rotating_file)"
          max_backup_files:
            type: integer
            minimum: 1
            maximum: 100
            default: 5
            description: "Number of backup files to keep (for rotating_file)"
          format_pattern:
            type: string
            default: "[%Y-%m-%d %H:%M:%S.%e] [%l] [%t] %v"
            description: "Log format pattern (spdlog format)"

      monitoring:
        type: object
        description: "Monitoring and observability configuration"
        properties:
          enabled:
            type: boolean
            default: true
            description: "Enable monitoring subsystem"
          metrics_interval_ms:
            type: integer
            minimum: 100
            maximum: 3600000
            default: 5000
            description: "Metrics collection interval in milliseconds"
          health_check_interval_ms:
            type: integer
            minimum: 1000
            maximum: 3600000
            default: 30000
            description: "Health check interval in milliseconds"
          prometheus_port:
            type: integer
            minimum: 0
            maximum: 65535
            default: 9090
            description: "Prometheus metrics port (0 to disable)"
          prometheus_path:
            type: string
            default: "/metrics"
            description: "Prometheus metrics endpoint path"
          tracing:
            type: object
            description: "Distributed tracing configuration"
            properties:
              enabled:
                type: boolean
                default: false
                description: "Enable distributed tracing"
              sampling_rate:
                type: number
                minimum: 0.0
                maximum: 1.0
                default: 0.1
                description: "Trace sampling rate (0.0 to 1.0)"
              exporter:
                type: string
                enum: [otlp, jaeger, zipkin, console]
                default: otlp
                description: "Trace exporter type"
              endpoint:
                type: string
                default: "http://localhost:4317"
                description: "Exporter endpoint URL"

      database:
        type: object
        description: "Database system configuration"
        properties:
          backend:
            type: string
            enum: [postgresql, mysql, sqlite, mongodb, redis]
            description: "Database backend type"
          connection_string:
            type: string
            description: "Database connection string or URI"
          log_queries:
            type: boolean
            default: false
            description: "Log all database queries"
          slow_query_threshold_ms:
            type: integer
            minimum: 0
            default: 1000
            description: "Slow query threshold in milliseconds"
          pool:
            type: object
            description: "Connection pool configuration"
            properties:
              min_size:
                type: integer
                minimum: 1
                maximum: 100
                default: 5
                description: "Minimum pool size"
              max_size:
                type: integer
                minimum: 1
                maximum: 1000
                default: 20
                description: "Maximum pool size"
              idle_timeout_ms:
                type: integer
                minimum: 0
                maximum: 3600000
                default: 60000
                description: "Idle connection timeout in milliseconds"
              acquire_timeout_ms:
                type: integer
                minimum: 0
                maximum: 60000
                default: 5000
                description: "Connection acquisition timeout in milliseconds"

      network:
        type: object
        description: "Network system configuration"
        properties:
          compression:
            type: string
            enum: [none, lz4, gzip, deflate, zstd]
            default: lz4
            description: "Data compression algorithm"
          buffer_size:
            type: integer
            minimum: 1024
            maximum: 16777216
            default: 65536
            description: "I/O buffer size in bytes"
          connect_timeout_ms:
            type: integer
            minimum: 0
            maximum: 60000
            default: 5000
            description: "Connection timeout in milliseconds"
          io_timeout_ms:
            type: integer
            minimum: 0
            maximum: 300000
            default: 30000
            description: "Read/write timeout in milliseconds"
          keepalive_interval_ms:
            type: integer
            minimum: 0
            maximum: 300000
            default: 15000
            description: "Keep-alive interval in milliseconds"
          max_connections:
            type: integer
            minimum: 1
            maximum: 1000000
            default: 10000
            description: "Maximum concurrent connections (server)"
          tls:
            type: object
            description: "TLS/SSL configuration"
            properties:
              enabled:
                type: boolean
                default: true
                description: "Enable TLS encryption"
              version:
                type: string
                enum: ["1.2", "1.3"]
                default: "1.3"
                description: "TLS protocol version"
              cert_path:
                type: string
                description: "Path to certificate file"
              key_path:
                type: string
                description: "Path to private key file"
              ca_path:
                type: string
                description: "Path to CA certificate file"
              verify_peer:
                type: boolean
                default: true
                description: "Verify peer certificate"

# Environment variable mapping
# All fields can be overridden via environment variables with UNIFIED_ prefix
# Nested keys use underscore separator
#
# Examples:
#   UNIFIED_THREAD_POOL_SIZE=16
#   UNIFIED_LOGGER_LEVEL=debug
#   UNIFIED_MONITORING_ENABLED=false
#   UNIFIED_DATABASE_CONNECTION_STRING=postgresql://localhost/mydb
#   UNIFIED_NETWORK_TLS_ENABLED=true
#   UNIFIED_MONITORING_TRACING_SAMPLING_RATE=0.5
